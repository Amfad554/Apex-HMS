// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =====================================================
// ENUMS
// =====================================================

enum HospitalType {
  public
  private
  specialty
  clinic
  medical_center
}

enum HospitalStatus {
  pending
  approved
  suspended
  rejected
}

enum StaffRole {
  doctor
  nurse
  pharmacist
  lab_staff
  receptionist
}

enum StaffStatus {
  active
  inactive
}

enum Gender {
  male
  female
  other
}

enum AppointmentStatus {
  scheduled
  completed
  cancelled
  no_show
}

enum PrescriptionStatus {
  active
  completed
  cancelled
}

enum RecordType {
  lab_results
  consultation
  imaging
  other
}

// =====================================================
// MODELS
// =====================================================

model SuperAdmin {
  id            Int        @id @default(autoincrement())
  username      String     @unique
  passwordHash  String     @map("password_hash")
  createdAt     DateTime   @default(now()) @map("created_at")
  
  approvedHospitals Hospital[] @relation("AdminApproval")

  @@map("super_admins")
}

model Hospital {
  id             Int            @id @default(autoincrement())
  hospitalName   String         @map("hospital_name")
  hospitalType   HospitalType   @map("hospital_type")
  address        String
  phone          String
  email          String         @unique
  licenseNumber  String         @unique @map("license_number")
  adminName      String         @map("admin_name")
  passwordHash   String         @map("password_hash")
  status         HospitalStatus @default(pending)
  createdAt      DateTime       @default(now()) @map("created_at")
  approvedAt     DateTime?      @map("approved_at")
  
  approvedBy     Int?           @map("approved_by")
  approver       SuperAdmin?    @relation("AdminApproval", fields: [approvedBy], references: [id])

  staff          HospitalStaff[]
  patients       Patient[]
  appointments   Appointment[]
  prescriptions  Prescription[]
  medicalRecords MedicalRecord[]

  @@index([status])
  @@index([email])
  @@map("hospitals")
}

model HospitalStaff {
  id           Int         @id @default(autoincrement())
  hospitalId   Int         @map("hospital_id")
  fullName     String      @map("full_name")
  role         StaffRole
  specialty    String?
  department   String?
  phone        String?
  email        String
  passwordHash String      @map("password_hash")
  status       StaffStatus @default(active)
  createdAt    DateTime    @default(now()) @map("created_at")

  hospital     Hospital    @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  
  appointments   Appointment[]
  prescriptions  Prescription[]
  medicalRecords MedicalRecord[]

  @@unique([hospitalId, email])
  @@index([hospitalId])
  @@map("hospital_staff")
}

model Patient {
  id              Int      @id @default(autoincrement())
  hospitalId      Int      @map("hospital_id")
  patientNumber   String   @unique @map("patient_number")
  fullName        String   @map("full_name")
  dateOfBirth     DateTime @map("date_of_birth")
  gender          Gender
  phone           String
  email           String?
  address         String
  bloodGroup      String?  @map("blood_group")
  medicalConditions String? @map("medical_conditions")
  nextOfKinName   String?  @map("next_of_kin_name")
  nextOfKinPhone  String?  @map("next_of_kin_phone")
  passwordHash    String?  @map("password_hash")
  createdAt       DateTime @default(now()) @map("created_at")

  hospital        Hospital @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  
  appointments    Appointment[]
  prescriptions   Prescription[]
  medicalRecords  MedicalRecord[]

  @@unique([hospitalId, email])
  @@index([hospitalId])
  @@index([patientNumber])
  @@map("patients")
}

model Appointment {
  id              Int               @id @default(autoincrement())
  hospitalId      Int               @map("hospital_id")
  patientId       Int               @map("patient_id")
  doctorId        Int               @map("doctor_id")
  appointmentDate DateTime          @db.Date @map("appointment_date")
  appointmentTime DateTime          @db.Time @map("appointment_time")
  reason          String
  status          AppointmentStatus @default(scheduled)
  notes           String?
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @default(now()) @updatedAt @map("updated_at")

  hospital        Hospital      @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  patient         Patient       @relation(fields: [patientId], references: [id], onDelete: Cascade)
  doctor          HospitalStaff @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@index([hospitalId])
  @@index([patientId])
  @@index([appointmentDate])
  @@map("appointments")
}

model Prescription {
  id             Int                @id @default(autoincrement())
  hospitalId     Int                @map("hospital_id")
  patientId      Int                @map("patient_id")
  doctorId       Int                @map("doctor_id")
  medication     String
  dosage         String
  duration       String
  instructions   String?
  refills        Int                @default(0)
  status         PrescriptionStatus @default(active)
  prescribedDate DateTime           @default(now()) @db.Date @map("prescribed_date")
  createdAt      DateTime           @default(now()) @map("created_at")

  hospital       Hospital      @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  patient        Patient       @relation(fields: [patientId], references: [id], onDelete: Cascade)
  doctor         HospitalStaff @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@index([patientId])
  @@map("prescriptions")
}

model MedicalRecord {
  id           Int        @id @default(autoincrement())
  hospitalId   Int        @map("hospital_id")
  patientId    Int        @map("patient_id")
  doctorId     Int        @map("doctor_id")
  recordType   RecordType @map("record_type")
  title        String
  diagnosis    String?
  findings     String?
  testResults  Json?      @map("test_results")
  vitals       Json?
  notes        String?
  recordDate   DateTime   @default(now()) @db.Date @map("record_date")
  createdAt    DateTime   @default(now()) @map("created_at")

  hospital     Hospital      @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  patient      Patient       @relation(fields: [patientId], references: [id], onDelete: Cascade)
  doctor       HospitalStaff @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@index([patientId])
  @@map("medical_records")
}